<div id="view" class="h-full w-screen flex flex-row"
    x-data="{ sidenav: window.innerWidth >= 768, showModal: false }"
    x-init="
        // Define o estado inicial da sidebar baseado na largura da tela ao carregar
        sidenav = window.innerWidth >= 768;

        // Listener para o redimensionamento da janela:
        // Mantém a sidebar visível em desktop (>= 768px)
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 768) {
                sidenav = true;
            }
            // Em telas menores, a sidebar será controlada apenas pelo botão
            // e pelo novo botão de fechar dentro dela, sem @click.away.
        });

        // Este $watch já é gerenciado pelo x-show e a classe :class,
        // mas pode ser útil para depuração ou se você adicionar outras lógicas.
        // Se você quiser simplificar ainda mais, pode remover este $watch.
        // Por enquanto, vamos mantê-lo.
        $watch('sidenav', value => {
            const sidebarElement = document.getElementById('sidebar');
            if (sidebarElement) { // Garante que o elemento existe antes de tentar manipular
                if(!value && window.innerWidth < 768) {
                    sidebarElement.classList.add('hidden');
                } else {
                    sidebarElement.classList.remove('hidden');
                }
            }
        });
    "
>
    <button @click="sidenav = true" class="p-2 border-2 bg-white rounded-md border-gray-200 shadow-lg text-gray-500 focus:bg-teal-500 focus:outline-none focus:text-white fixed top-16 left-0 sm:hidden z-50">
        <svg class="w-5 h-5 fill-current" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
        </svg>
    </button>

    <div id="sidebar"
         class="bg-cray h-screen fixed top-16 left-0 shadow-xl px-3 w-20 md:w-60 lg:w-60 transition-transform duration-300 ease-in-out z-40"
         x-show="sidenav"
         x-cloak
         :class="{'translate-x-0': sidenav, '-translate-x-full': !sidenav && window.innerWidth < 768}"
    >
        <button @click="sidenav = false" class="p-2 text-gray-500 hover:text-gray-700 focus:outline-none sm:hidden absolute top-2 right-2">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>

        <div class="space-y-6 md:space-y-6 mt-6">
            <h1 class="font-bold text-xl text-center md:hidden">D<span class="text-teal-600">.</span></h1>
            <h1 class="hidden md:block font-bold text-base md:text-xl text-center ">Painel Administração<span class="text-teal-600"></span></h1>
            <div id="profile" class="space-y-3">
                <img src="https://images.unsplash.com/photo-1628157588553-5eeea00af15c?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=880&q=80" alt="Avatar user" class="w-10 md:w-16 rounded-full mx-auto" />
                <div>
                    <h2 class="font-medium text-xs md:text-sm text-center text-teal-500">Eduard Pantazi</h2>
                    <p class="text-xs text-gray-500 text-center">Administrator</p>
                </div>
            </div>
            <div id="menu" class="flex flex-col space-y-2">
                <a class="text-sm font-medium text-gray-700 py-2 px-2 hover:bg-teal-500 hover:text-white hover:text-base rounded-md transition duration-150 ease-in-out">
                    <svg class="w-6 h-6 fill-current inline-block" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
                    </svg>
                    <button id="meuseventos">Meus eventos</button>
                </a>
                <a class="text-sm font-medium text-gray-700 py-2 px-2 hover:bg-teal-500 hover:text-white hover:scale-105 rounded-md transition duration-150 ease-in-out">
                    <svg class="w-6 h-6 fill-current inline-block" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path d="M11 17a1 1 0 001.447.894l4-2A1 1 0 0017 15V9.236a1 1 0 00-1.447-.894l-4 2a1 1 0 00-.553.894V17zM15.211 6.276a1 1 0 000-1.788l-4.764-2.382a1 1 0 00-.894 0L4.789 4.488a1 1 0 000 1.788l4.764 2.382a1 1 0 00.894 0l4.764-2.382zM4.447 8.342A1 1 0 003 9.236V15a1 1 0 00.553.894l4 2A1 1 0 009 17v-5.764a1 1 0 00-.553-.894l-4-2z"></path>
                    </svg>
                    <span class="">Products</span>
                </a>
                <a href="" class="text-sm font-medium text-gray-700 py-2 px-2 hover:bg-teal-500 hover:text-white hover:scale-105 rounded-md transition duration-150 ease-in-out">
                    <svg class="w-6 h-6 fill-current inline-block" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                        <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
                    </svg>
                    <span class="">Users</span>
                </a>
            </div>
        </div>
    </div>

    <div class="flex-grow pl-20 md:pl-60 lg:pl-60 pt-1 pb-8">
        <div class="mt-8 ml-4 mr-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
            {{#each eventos}}
            <div class="border border-gray-200 rounded-lg p-4 shadow-md bg-white">
                <div class="text-center text-lg font-bold uppercase mb-2">
                    <a href="#">{{this.titulo}}</a>
                </div>
                <div class="text-gray-700 text-sm">
                    
                    <span><strong>Local:</strong> {{this.cidade}} - {{this.estado}}</span><br>
                    <span><strong>Data:</strong> {{this.dataformatada}}</span>
                </div>
                <div class="mt-4 flex justify-center space-x-2">
                    <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                        Detalhes
                    </button>
                    <button class="bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded">
                        Editar
                    </button>
                    <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
                        Excluir
                    </button>
                </div>
            </div>
            {{else}}
            <div id="no-events-message" class="text-gray-600 text-center col-span-full">
                <p>Nenhum evento criado ainda.</p>
            </div>
            {{/each}}
        </div>

        <div class="text-center mt-8 mb-8">
            <button @click="showModal = true"
                    class="select-none rounded-lg bg-gray-900 py-3 px-6 text-center align-middle font-sans text-xs font-bold uppercase text-white shadow-md shadow-gray-900/10 transition-all hover:shadow-lg hover:shadow-gray-900/20 focus:opacity-[0.85] focus:shadow-none active:opacity-[0.85] active:shadow-none"
                    type="button">
                Cadastro de eventos
            </button>
        </div>
    </div>

    <div x-show="showModal"
         class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"
         x-transition:enter="ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         @click.away="showModal = false"
         x-cloak
         x-trap.inert="showModal"
    >
        <div class="bg-white rounded-lg p-6 shadow-xl max-w-lg w-full relative" @click.stop>
            <button @click="showModal = false" class="absolute top-3 right-3 text-gray-500 hover:text-gray-700 text-2xl font-bold">&times;</button>

            <form action="/cadastrarevento" method="POST" id="eventoform" class="w-full mt-4">
                <h2 class="text-xl font-bold text-gray-800 mb-4 text-center">Cadastrar Novo Evento</h2>
                <div class="flex flex-wrap -mx-3 mb-6">
                    <div class="w-full md:w-1/2 px-3 mb-6 md:mb-0">
                        <label class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2" for="titulo">
                            Nome do evento
                        </label>
                        <input id="titulo" name="titulo" class="appearance-none block w-full bg-gray-200 text-gray-700 border rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white" type="text" required>
                    </div>
                   <!-- <div class="w-full md:w-1/2 px-3">
                        <label class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2" for="endereco">
                            Endereço do evento
                        </label>
                        <input id="endereco" name="endereco" class="appearance-none block w-full bg-gray-200 text-gray-700 border rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white" type="text" required>
                    </div> -->
                    <div class="w-full md:w-1/2 px-3 mb-6 md:mb-0">
                        <label for="eventotipo" class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2">Tipo de evento:</label>
                        <select id="eventotipo" class="block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white focus:border-gray-500" name="eventotipo" required>
                            <option value="">Selecione um tipo</option>
                            <option value="social">Social/Festa</option>
                            <option value="conferencia">Conferência</option>
                            <option value="festival">Festival</option>
                            <option value="exposicao">Exposição/Feira</option>
                            <option value="workshop">Workshop/Seminário</option>
                            <option value="congresso">Congresso</option>
                            <option value="esportivo">Esportivo</option>
                            <option value="cultural">Cultural/Arteístico</option>
                            <option value="concerto">Concerto</option>
                            <option value="beneficente">Beneficente/Arrecadação de Fundos</option>
                        </select>
                    </div>
                </div>
                <div class="flex flex-wrap -mx-3 mb-6">
                    <div class="w-full px-3">
                        <label for="descricao" class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2">
                            Descrição/Observações
                        </label>
                        <textarea name="descricao" class="appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white focus:border-gray-500"></textarea>
                    </div>
                </div>
                <div class="flex flex-wrap -mx-3 mb-2">
                    <div class="w-full md:w-1/3 px-3 mb-6 md:mb-0">
                        <label for="estado" class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2">Estado:</label>
                        <select id="estado" name="estado" class="block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white focus:border-gray-500" required></select>
                    </div>
                    <div class="w-full md:w-1/3 px-3 mb-6 md:mb-0">
                        <label for="cidade" class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2">Cidade:</label>
                        <select id="cidade" name="cidade" class="block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white focus:border-gray-500" required></select>
                    </div>
                    <div class="w-full md:w-1/3 px-3 mb-6 md:mb-0">
                        <label class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2 ml-4" for="data">Data</label>
                        <input id="date" name="data" type="date" class="appearance-none block w-full bg-gray-200 text-gray-700 border rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white" required>
                    </div>
                </div>
                
                <div class="flex flex-wrap -mx-3 mb-6">
                    
                
                <div class="flex justify-center mt-6">
                    <button type="submit" class="rounded-lg bg-gray-900 py-3 px-6 h-10 text-center align-middle font-sans text-xs font-bold uppercase text-white shadow-md shadow-gray-900/10 transition-all hover:shadow-lg hover:shadow-gray-900/20 focus:opacity-[0.85] focus:shadow-none active:opacity-[0.85] active:shadow-none mr-4">Salvar</button>
                    <button type="button" @click="showModal = false" class="rounded-lg bg-gray-400 py-3 px-6 h-10 text-center align-middle font-sans text-xs font-bold uppercase text-white shadow-md shadow-gray-400/10 transition-all hover:shadow-lg hover:shadow-gray-400/20 focus:opacity-[0.85] focus:shadow-none active:opacity-[0.85] active:shadow-none">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/focus@3.x.x/dist/cdn.min.js"></script>
<script src="/script.js"></script>